<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layouts/layout}"
        lang="en"
>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
            crossorigin="anonymous"></script>

    <style>
        @media (max-width: 767px) {
            .cardBox {
                flex: 0 0 calc(50% - 20px);
            }
        }

        #promoBrdRegion{
        width: 150px;
        height: 50px;
        padding: 5px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 4px;
        }

        #promoBrdCategory{
        width: 150px;
        height: 50px;
        padding: 5px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 4px;
        }

        #writeGen{
        margin-left: 60%;
        }

        #writeEvent{
        margin-left: 3%;
        }

        .proGenCreate{
        display: inline-block;
        padding: 10px 20px; /* 내부 여백 조정 */
        text-decoration: none; /* 기본 밑줄 제거 */
        color: #ffffff; /* 텍스트 색상 */
        background-color: #2ECC71; /* 배경색 */
        border: 1px solid #2ECC71; /* 테두리 스타일과 색상 */
        border-radius: 5px; /* 테두리 모서리 둥글게 만들기 */
        font-weight: bold; /* 텍스트 굵게 설정 */
        width:150px;
        height:50px;
        }

        .proEventCreate{
        display: inline-block;
        padding: 10px 20px; /* 내부 여백 조정 */
        text-decoration: none; /* 기본 밑줄 제거 */
        color: #ffffff; /* 텍스트 색상 */
        background-color: #2ECC71; /* 배경색 */
        border: 1px solid #2ECC71; /* 테두리 스타일과 색상 */
        border-radius: 5px; /* 테두리 모서리 둥글게 만들기 */
        font-weight: bold; /* 텍스트 굵게 설정 */
        width: 150px;
        height:50px;
        }

    </style>
</head>
<div layout:fragment="content">

    <div>
        <h3 style="margin-left:5%;">홍보 게시판</h3>
    </div>
    <div class="dropdownContainer" style="display: flex; margin-bottom: 50px; margin-left: 5%;">
        <div class="dropdown"><!-- 지역 선택 드롭다운 -->
            <label for="promoBrdRegion"></label>
            <select name="promoBrdRegion" id="promoBrdRegion" onchange="updateData()">
                <option value="">지역 선택</option>
                <option value="중구">중구</option>
                <option value="서구">서구</option>
                <option value="동구">동구</option>
                <option value="영도구">영도구</option>
                <option value="부산진구">부산진구</option>
                <option value="동래구">동래구</option>
                <option value="남구">남구</option>
                <option value="북구">북구</option>
                <option value="강서구">강서구</option>
                <option value="해운대구">해운대구</option>
                <option value="사하구">사하구</option>
                <option value="금정구">금정구</option>
                <option value="연제구">연제구</option>
                <option value="수영구">수영구</option>
                <option value="사상구">사상구</option>
                <option value="기장군">기장군</option>
            </select>

            <div id="result1"></div>

        </div>
        <!-- 게시글 유형 드롭다운 -->
        <div class="dropdown"><!-- 지역 선택 드롭다운 -->
            <label for="promoBrdCategory"></label>
            <select name="promoBrdCategory" id="promoBrdCategory" onchange="updateData()">
                <option value="">게시글 유형</option>
                <option value="0">일반</option>
                <option value="1">체험</option>
                <option value="2">이벤트</option>

            </select>
            <div id="result2"></div>
        </div>

        <div id="writeGen"><!-- 글쓰기 버튼 -->
            <a th:href="@{/promotion/genCreate}">
                <button class="proGenCreate">일반 홍보</button>
            </a>
        </div>
        <div id="writeEvent"><!-- 글쓰기 버튼 -->
            <a th:href="@{/promotion/eventCreate}">
                <button class="proEventCreate">체험/이벤트</button>
            </a>
        </div>
    </div>


    <div id="result">
        <div class="cardContainer" style="display: flex; flex-wrap: wrap; justify-content: space-around;">
            <div th:each="promotion : ${promotions}" class="cardBox" style="flex: 0 0 calc(20% - 5%); margin: 10px;">
                <!--                <div th:each="promotion, iterStat : ${promotions}" class="cardBox" style="flex: 0 0 calc(20% - 5%); margin: 10px;"-->
                <!--                 th:if="${iterStat.index < 20}">-->
                <div class="card" style="width: 350px; height: 100%; border: 1px solid;">
                    <a th:href="@{/promotion/{genEvent}/{promoBrdPostId}(genEvent=${promotion.promoBrdCategory == 0} ? 'gendetail' : 'eventdetail', promoBrdPostId=${promotion.promoBrdPostId})}"
                       style="text-decoration:none; color: #000000;">
                        <!-- 이미지 표시 -->
                        <img th:src="${promotion.promoBrdMainImg}" class="card-img-top img-fluid" alt="홍보 이미지"
                             style="object-fit: cover; object-position: top; width: 100%; height: 200px; min-height: 200px;">
                        <!-- 카드 내용을 표시하는 부분 -->
                        <div class="card-body">
                            <h5 class="card-title" th:text="${promotion.promoBrdTitle}"></h5>
                            <div class="card-text">
                                <p th:if="${promotion.promoBrdCategory == 1}" class="card-EventEndDate experience-card"
                                   th:text="'체험일: ' + promotion.promoBrdExperienceDate"></p>

                                <p th:if="${promotion.promoBrdCategory == 2}" class="card-EventEndDate event-card"
                                   th:text="'이벤트 종료일: ' + promotion.promoBrdEventEndDate"></p>
                                <p class="card-BusinessName" th:text="'상호명: ' + ${promotion.promoBrdBusinessName}"></p>
                                <p th:if="${promotion.promoBrdCategory == 1}" class="card-Participants"
                                   th:text="'참여 인원: ' + ${promotion.promoBrdApplyParticipants} + '/' + ${promotion.promoBrdMaxParticipants}"></p>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        <div>
            <div class="promoPaging"> <!-- 페이징 처리 -->
<!--                <th:block th:each="page : ${#numbers.sequence(startPage, endPage)}">-->
<!--                    <a th:if="${page != nowPage}" th:href="@{/promotion(page = ${page -1})}" th:text="${page}"></a>-->
<!--                    <strong th:if="${page == nowPage}" th:text="${page}"></strong>-->
<!--                </th:block>-->
            </div>
        </div>
    </div>

    <div>
        <div> <!-- 검색 제목 + 내용 -->

        </div>
        <div> <!-- 검색 텍스트 입력창 -->

        </div>
        <div> <!-- 검색 버튼 -->

        </div>
    </div>

    <script>
        // 페이지 로드 될 때 실행
document.addEventListener("DOMContentLoaded", function() {
    // updateData 함수 호출
    updateData();
});

function updateData() {
    var selectedDistrict = $("#promoBrdRegion").val();
    var selectedCategory = $("#promoBrdCategory").val();

    // 게시글 유형이 선택되지 않았을 때
    var dataToSend = {};

    if (selectedDistrict !== "") {
        dataToSend.promoBrdRegion = selectedDistrict;
    }

    if (selectedCategory !== "") {
        dataToSend.promoBrdCategory = parseInt(selectedCategory);
    }

    // 지역과 카테고리 데이터를 컨트롤러에 전달.
    $.ajax({
        type: "GET",
        url: "/updatePromotion?timestamp=" + new Date().getTime(),
        async: true,
        data: dataToSend,
        contentType: "application/json",
        success: function (data, status, xhr) {
            $("#result").html(data);
            displayRemainingDays(); // 남은 날짜 표시 함수 호출
        },
        error: function (xhr, status, error) {
            console.error("Error while fetching data: ", error);
        }
    });
    displayRemainingExpDay()
    displayRemainingDays();

}

$(document).ready(function() {
    if ($(".card-EventEndDate").hasClass("experience-card")) {
        displayRemainingExpDay();
    } else if ($(".card-EventEndDate").hasClass("event-card")) {
        displayRemainingDays();
    }
});

// promoBrdCategory가 체험(1)인 경우 체험일과 현재 날짜 비교.
function displayRemainingExpDay() {
    $(".card-EventEndDate").each(function() {
        var promoBrdExperienceDate = new Date($(this).text()); // 체험일을 Date 객체로 변환
        var currentDate = new Date(); // 현재 날짜를 Date 객체로 변환

        // 남은 날짜 계산.
        var timeDifference = promoBrdExperienceDate.getTime() - currentDate.getTime();
        var remainingDays = Math.ceil(timeDifference / (1000 * 3600 * 24));

        // 결과 표시함.
        if (remainingDays > 0) {
            $(this).append(" (남은 날짜: " + remainingDays + "일)");
        } else {
            $(this).append(" (종료된 이벤트입니다.)");
        }
    });
}

// promoBrdCategory가 이벤트(2)인 경우 이벤트 종료일과 현재 날짜 비교하여 남은 날짜를 표시하는 함수.
function displayRemainingDays() {
    $(".card-EventEndDate").each(function() {
        var eventEndDate = new Date($(this).text()); // 이벤트 종료일을 Date 객체로 변환
        var currentDate = new Date(); // 현재 날짜를 Date 객체로 변환

        // 남은 날짜 계산.
        var timeDifference = eventEndDate.getTime() - currentDate.getTime();
        var remainingDays = Math.ceil(timeDifference / (1000 * 3600 * 24));

        // 결과 표시함.
        if (remainingDays > 0) {
            $(this).append(" (남은 날짜: " + remainingDays + "일)");
        } else {
            $(this).append(" (종료된 이벤트입니다.)");
        }
    });
}

    </script>
</div>
<!-- re push -->


</html>



